var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);

app.get('/', function(req, res){
    res.sendFile(__dirname + '/index.html');
});
 var roomsArray = {};
io.on('connection', function(socket){
    console.log(socket.id);
    roomsArray.lobby = [];
    roomsArray.lobby = roomsArray.lobby.push(socket.id);
    socket.emit('sockets in lobby', roomsArray);
     
    if(roomsArray!='') {
        socket.emit("server room created", roomsArray);
    }
     socket.on('room message', function(data){
        io.sockets.in(data.roomId).emit('chat message', data.message);
        });
    socket.on("create room", function (data) {
        var id = data.roomId;
        socket.join(id);
        socket.emit("show current room", id);
        if(!roomsArray[id]){
            roomsArray[id] = [];
            roomsArray[id].push(socket.id);
            io.emit('server room created', roomsArray);
        }else{
            io.emit('server room created', roomsArray);
        }
    });
    console.log(roomsArray);
    socket.on("leave", function (data) {
        socket.broadcast.to(data.roomToLeave).emit('chat message', {
            leftstatus:1,
            id:data.id
        });
         socket.leave(data.roomToLeave, function (res) {
             socket.join(data.joinRoomId);
             socket.emit('new room joined', data.joinRoomId);
         })
    });

});

http.listen(3000, function(){
    console.log('listening on *:3000');
});